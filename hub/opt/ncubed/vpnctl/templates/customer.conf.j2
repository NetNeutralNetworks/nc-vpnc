connections {
{% for conn in connections %}
    {# t_id is tunnel_id for customer #}
    {{ conn.cust_id }}-{{ conn.t_id }} : {{ conn.ike_proposal }} {
        # Remote address(es) to use for IKE communication, comma separated.
        remote_addrs = {{ conn.vpn_peer_ip }}
        # Default inbound XFRM interface ID for children.
        if_id_in = {{ conn.xfrm_id }}
        # Default outbound XFRM interface ID for children.
        if_id_out = {{ conn.xfrm_id }}
        # Section for a local authentication round.
        local {
            id = {{ conn.local_id }}
        }
        # Section for a remote authentication round.
        remote {
            id = {{ conn.remote_id }}
        }

        children {
            # CHILD_SA configuration sub-section.
    {# ts are traffic selectors #}
    {% if ts is not defined or not ts %}
            {{ conn.cust_id }}-{{ conn.t_id }} : {{ conn.ipsec_proposal }} {}
    {% elif ts is defined and ts %}
            {{ conn.cust_id }}-{{ conn.t_id }} : {{ conn.ipsec_proposal }} {
                # Local traffic selectors to include in CHILD_SA.
                local_ts = {{ conn.ts.local }}
                # Remote selectors to include in CHILD_SA.
                remote_ts = {{ conn.ts.remote }}
            }
        }
    {% endif %}
    }
{% endfor %}
}

secrets {
{% for connection in connections %}
    {{ conn.cust_id }}-{{ conn.t_id }} {
        secret = "{{ conn.psk }}"
    }
{% endfor %}
}
